<?php
require 'PHPExcel/PHPExcel.php';

if ($_SERVER["REQUEST_METHOD"] == "POST") {
  if ($_FILES["archivoExcel"]["error"] == UPLOAD_ERR_OK) {
    $nombreArchivo = $_FILES["archivoExcel"]["name"];
    $rutaArchivo = $_FILES["archivoExcel"]["tmp_name"];

    // Crear un objeto PHPExcel para cargar el archivo Excel
    $excel = PHPExcel_IOFactory::load($rutaArchivo);
    $sheet = $excel->getActiveSheet();

    // Crear un objeto SimpleXMLElement para generar el XML
    $xml = new SimpleXMLElement('<?xml version="1.0" encoding="UTF-8"?><datos></datos>');

    // Recorrer las filas del archivo Excel y agregar los datos al XML
    foreach ($sheet->getRowIterator() as $row) {
      $xmlRow = $xml->addChild('row');
      foreach ($row->getCellIterator() as $cell) {
        $xmlRow->addChild('cell', $cell->getValue());
      }
    }

    // Generar el archivo XML
    $xmlFilePath = 'archivo.xml';
    file_put_contents($xmlFilePath, $xml->asXML());

    header('Content-Type: application/xml');
    header('Content-Disposition: attachment; filename="' . $xmlFilePath . '"');
    readfile($xmlFilePath);
    unlink($xmlFilePath);
  } else {
    echo "Error al cargar el archivo.";
  }
}
?>
